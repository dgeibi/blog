<!DOCTYPE html><html lang="cmn-hans" manifest="/plain.appcache"><head><meta charset="utf-8"><title>OpenWrt + iNode | dgeibi's blog</title><meta name="author" content="dgeibi"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta name="renderer" content="webkit|ie-comp|ie-stand"><link rel="stylesheet" href="/css/style.css"><link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml"><link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml"><link rel="canonical" href="https://blog.dgeibi.xyz/2015/11/19/openwrt-h3c/index.html"><link rel="icon" type="image/png" href="/favicon.png"><link rel="apple-touch-icon" sizes="256x256" href="/favicon.png"><link rel="manifest" href="/manifest.json"><script src="/js/main.js" defer></script></head><body><header class="site-header"><div class="wrapper"><a class="site-title" href="/">dgeibi's blog</a><nav class="site-nav"><a class="nav-item" href="/archives/">归档 </a><a class="nav-item" href="/about/">关于 </a><a class="nav-item" href="/atom.xml">Feed </a></nav></div></header><main class="page-content"><div class="wrapper"><article class="post"><header class="post-header"><h1 class="post-title" itemprop="name headline">OpenWrt + iNode</h1><section class="meta">发表于 <time datetime="2015-11-19T23:59:55+08:00">2015-11-19</time>&nbsp;|&nbsp;修改于 <time datetime="2017-01-11T15:12:04+08:00">2017-01-11</time></section><section class="meta"></section><section class="meta">标签: &nbsp;<span><a href="/archives/tags/openwrt/">#OpenWrt</a></span></section></header><section id="toc"><h2 class="heading">Content</h2><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#参考"><span class="toc-number">1.</span> <span class="toc-text">参考</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#选购路由器"><span class="toc-number">2.</span> <span class="toc-text">选购路由器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#编译"><span class="toc-number">3.</span> <span class="toc-text">编译</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#安装编译工具的依赖"><span class="toc-number">3.1.</span> <span class="toc-text">安装编译工具的依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#获取-OpenWrt-LEDE-代码树"><span class="toc-number">3.2.</span> <span class="toc-text">获取 OpenWrt/LEDE 代码树</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#更新和安装-feeds"><span class="toc-number">3.3.</span> <span class="toc-text">更新和安装 feeds</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#获取-gduth3c-源码"><span class="toc-number">3.4.</span> <span class="toc-text">获取 gduth3c 源码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置编译信息"><span class="toc-number">3.5.</span> <span class="toc-text">配置编译信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#开始编译"><span class="toc-number">3.6.</span> <span class="toc-text">开始编译</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#设置、安装-ipk"><span class="toc-number">4.</span> <span class="toc-text">设置、安装 ipk</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#另一个-GDUT-专用的认证软件"><span class="toc-number">5.</span> <span class="toc-text">另一个 GDUT 专用的认证软件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#编译成果"><span class="toc-number">6.</span> <span class="toc-text">编译成果</span></a></li></ol></section><section class="post-content toc-src" itemprop="articleBody"><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://wiki.openwrt.org/doc/howto/buildroot.exigence" target="_blank" rel="external">OpenWrt build system – Installation</a></li>
<li><a href="http://young523.com/?p=102" target="_blank" rel="external">自己编译集成了 shadowsocks 的 openwrt 固件</a></li>
<li><a href="http://www.7forz.com/1973/" target="_blank" rel="external">【详细教程】编译 openwrt + njit-client 1.3，通过 iNode 认证</a></li>
<li><a href="https://github.com/wongsyrone/LinuxNotes/blob/master/06.md" target="_blank" rel="external">LinuxNotes/06.md at master · wongsyrone/LinuxNotes</a></li>
</ul>
<h2 id="选购路由器"><a href="#选购路由器" class="headerlink" title="选购路由器"></a>选购路由器</h2><p>配置挺高，实惠的 Newifi Mini 受 OpenWrt 官方支持，可参照 <a href="https://linuxtoy.org/archives/install-openwrt-on-newifi-mini.html" target="_blank" rel="external">Newifi Mini 安装 OpenWrt</a> 刷入固件</p>
<p>注：刷 OpenWrt 的最低配置是 4MB Flash、32MB RAM</p>
<h2 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h2><h3 id="安装编译工具的依赖"><a href="#安装编译工具的依赖" class="headerlink" title="安装编译工具的依赖"></a>安装编译工具的依赖</h3><p>假定使用 Ubuntu 编译，操作过程中可能遇到网络问题，可参考以下解决方案</p>
<ul>
<li><a href="/2015/11/25/terminal-proxy/">设置终端下的代理</a></li>
<li><a href="/2015/12/02/fix-apt-hash/">解决 Hash Sum mismatch 错误</a></li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">sudo apt-get update</div><div class="line">sudo apt-get install build-essential subversion libncurses5-dev zlib1g-dev gawk gcc-multilib flex git-core gettext libssl-dev</div></pre></td></tr></table></figure>
<h3 id="获取-OpenWrt-LEDE-代码树"><a href="#获取-OpenWrt-LEDE-代码树" class="headerlink" title="获取 OpenWrt/LEDE 代码树"></a>获取 OpenWrt/LEDE 代码树</h3><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line"><span class="comment">#开发版 (trunk)</span></div><div class="line">git <span class="built_in">clone</span> -b master --single-branch https://github.com/openwrt/openwrt.git</div><div class="line"><span class="comment">#或稳定版（如 Chaos Calmer）</span></div><div class="line">git <span class="built_in">clone</span> -b chaos_calmer --single-branch https://github.com/openwrt/openwrt.git</div><div class="line"><span class="comment">#或 LEDE</span></div><div class="line">git <span class="built_in">clone</span> https://git.lede-project.org/source.git lede</div></pre></td></tr></table></figure>
<h3 id="更新和安装-feeds"><a href="#更新和安装-feeds" class="headerlink" title="更新和安装 feeds"></a>更新和安装 feeds</h3><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line"><span class="built_in">cd</span> openwrt <span class="comment">#或 cd lede</span></div><div class="line">./scripts/feeds update <span class="_">-a</span></div><div class="line">./scripts/feeds install <span class="_">-a</span></div></pre></td></tr></table></figure>
<h3 id="获取-gduth3c-源码"><a href="#获取-gduth3c-源码" class="headerlink" title="获取 gduth3c 源码"></a>获取 <a href="https://github.com/hazytint/gduth3c" target="_blank" rel="external">gduth3c</a> 源码</h3><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">git <span class="built_in">clone</span> https://github.com/hazytint/gduth3c.git package/gduth3c</div><div class="line">git <span class="built_in">clone</span> https://github.com/dgeibi/luci-app-gduth3c.git package/luci-app-gduth3c</div></pre></td></tr></table></figure>
<p>gduth3c 是主要程序，用于通过校园网的识别；luci-app-gduth3c 用于保存账号、密码，开机启动 gduth3c。</p>
<p>gduth3c 适用于广工以前使用的 iNode。</p>
<h3 id="配置编译信息"><a href="#配置编译信息" class="headerlink" title="配置编译信息"></a>配置编译信息</h3><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">make menuconfig</div></pre></td></tr></table></figure>
<p>进入定制界面</p>
<p>操作规则：</p>
<ul>
<li>/ 搜索</li>
<li>方向键 移动光标</li>
<li>回车键 确认</li>
<li>空格键 切换 M  *</li>
<li><code>&lt;M&gt;</code> 表示编译成 ipk，不集成在固件里，可以用 OPKG 软件包管理器进行安装</li>
<li><code>&lt;*&gt;</code> 表示集成在固件中。</li>
</ul>
<p>配置示例：</p>
<ol>
<li>Target System –&gt; AR71xx/AR9xxx        \\ 选择 CPU 型号</li>
<li>Target Profile –&gt; GL-iNet          \\ 选择路由器型号</li>
<li>LuCI –&gt; Collections –&gt; &lt;*&gt; luci        \\ 添加 LuCI 网页界面</li>
<li>LuCI –&gt; (Moudles) –&gt; Translations –&gt; &lt;*&gt; Chinese        \\ 添加中文支持</li>
<li>Kernel modules –&gt; Native Language Support –&gt; &lt;*&gt; kmod-nls-utf8        \\ 添加 UTF8 编码</li>
<li>Utilities –&gt; &lt;*&gt;gduth3c</li>
<li>LuCI -&gt; Applications -&gt; &lt;*&gt;luci-app-gduth3c</li>
<li>…</li>
<li>Exit –&gt; Yes         \\ 退出并保存</li>
</ol>
<h3 id="开始编译"><a href="#开始编译" class="headerlink" title="开始编译"></a>开始编译</h3><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">make V=s  <span class="comment">#编译固件</span></div></pre></td></tr></table></figure>
<p>路由器固件在 <code>bin/ar71xx/</code></p>
<p>ipk 文件在 <code>bin/ar71xx/packages/</code></p>
<h2 id="设置、安装-ipk"><a href="#设置、安装-ipk" class="headerlink" title="设置、安装 ipk"></a>设置、安装 ipk</h2><p>利用编译好的 bin 刷机 (可选)</p>
<p>接通电源，用网线连通路由器 LAN 端口和电脑。</p>
<p>打开 192.168.1.1</p>
<ol>
<li>系统 –&gt; 管理权 –&gt; 填入主机密码。</li>
<li>网络 –&gt; 接口 –&gt; WAN –&gt; 修改 –&gt; 高级设置 –&gt; 克隆 MAC 地址（填入电脑网卡的 MAC 地址）</li>
</ol>
<p>这里有 <a href="http://aruljohn.com/mac/D864C75EF1C6" target="_blank" rel="external">查看电脑 MAC 地址的方法</a>。</p>
<p>Windows 下推荐使用 <a href="https://git-scm.com/" target="_blank" rel="external">Git for Windows</a> 的 Git Bash 进行以下操作。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">scp gduth3c_1.0-1_ar71xx.ipk luci-app-gduth3c_1.0-1_all.ipk root@192.168.5.1:/tmp  <span class="comment">#将文件传到路由器的 / tmp 目录，如果固件自带跳过</span></div><div class="line">ssh root@192.168.1.1 <span class="comment">#登录 ssh</span></div><div class="line">opkg install /tmp/gduth3c_1.0-1_ar71xx.ipk <span class="comment">#如果固件自带跳过</span></div><div class="line">opkg install /tmp/luci-app-gduth3c_1.0-1_all.ipk <span class="comment">#如果固件自带跳过</span></div><div class="line">gduth3c -u [username] -p [password] -i [interface] <span class="comment">#测试能否通过校园网认证</span></div></pre></td></tr></table></figure>
<p>[interface] 是物理接口，一般是 eth0，要对应你的 WAN 口，在 <code>网络 -&gt; 接口</code> 里就可以查看。</p>
<p>测试通过，则在 192.168.1.1 的 <code>网络 --&gt; gduth3c</code> 勾选启用，输入校园网账号、密码，保存并应用。</p>
<h2 id="另一个-GDUT-专用的认证软件"><a href="#另一个-GDUT-专用的认证软件" class="headerlink" title="另一个 GDUT 专用的认证软件"></a>另一个 GDUT 专用的认证软件</h2><p><a href="https://github.com/hazytint/gdut8021xclient" target="_blank" rel="external">gdut8021xclient</a></p>
<p>编译 <code>gdut8021xclient</code> 时需先把 clone 得到的文件夹改名为 <code>njit8021xclient</code></p>
<p>还要将根目录里的 <code>Makefile_OpenWrt</code> 改为 <code>Makefile</code>，<code>make menuconfig</code> 后在 <code>Network</code> 里选择。</p>
<h2 id="编译成果"><a href="#编译成果" class="headerlink" title="编译成果"></a>编译成果</h2><p>Built for Chaos Calmer 15.05</p>
<ul>
<li><a href="/assets/files/gduth3c_1.0-1_ar71xx.ipk">gduth3c_1.0-1_ar71xx.ipk</a></li>
<li><a href="/assets/files/luci-app-gduth3c_1.0-1_all.ipk">luci-app-gduth3c_1.0-1_all.ipk</a></li>
<li><a href="/assets/files/libpcap_1.5.3-1_ar71xx.ipk">libpcap_1.5.3-1_ar71xx.ipk</a></li>
<li><a href="/assets/files/njit8021xclient_1.3-testing_ar71xx.ipk">njit8021xclient_1.3-testing_ar71xx.ipk</a></li>
<li><a href="/assets/files/luci-app-njitclient_1.0-1_all.ipk">luci-app-njitclient_1.0-1_all.ipk</a></li>
</ul>
</section></article></div></main><footer class="site-footer"><section><small>&copy; 2015-2017
 dgeibi <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></small></section><section><small>Powered by <a href="https://hexo.io">Hexo</a>. Theme by <a href="https://github.com/dgeibi">dgeibi</a>.</small></section></footer><a class="back-to-top" data-js-backtotop href="#" title="Back to top">&uarr;</a></body></html>